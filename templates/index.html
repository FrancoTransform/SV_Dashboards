<!DOCTYPE html>
<html>
<head>
    <title>SemperVirens Accelerator Submissions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sv-blue': '#0A2540',
                        'sv-green': '#00B67A',
                        'sv-green-dark': '#00A067',
                    }
                }
            }
        }
    </script>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <style>
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Tab Styles */
        .tab-button {
            color: #9CA3AF;
            background-color: transparent;
        }

        .tab-button.active {
            color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .tab-button:hover:not(.active) {
            color: #D1D5DB;
            background-color: rgba(255, 255, 255, 0.05);
        }

        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-sv-blue">
    <div class="min-h-screen">
        <nav class="border-b border-gray-700">
            <div class="container mx-auto px-6 py-4 flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <img src="{{ url_for('static', filename='SemperVirens-white-logo.avif') }}" 
                         alt="SemperVirens" 
                         class="h-8">
                    <h1 class="text-2xl font-bold text-white">Accelerator</h1>
                </div>
                <a href="{{ url_for('logout') }}" class="text-sm text-gray-400 hover:text-white">Logout</a>
            </div>
        </nav>
        
        <main class="container mx-auto px-6 py-8">
            <div class="mb-8 flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-white">Submission Analysis Dashboard</h2>
                <div class="text-sm text-gray-400">
                    <span id="search-results" style="display: none;">
                        Showing <span id="visible-count">0</span> of {{ (submissions|length) }} submissions
                    </span>
                    <span id="total-count">
                        Total Submissions: {{ (submissions|length) }}
                    </span>
                </div>
            </div>

            <!-- Add this button section after the existing header but before the company list -->
            <div class="mb-6 flex justify-center">
                <button id="generateAnalysis" class="inline-flex items-center px-8 py-4 text-lg font-semibold bg-sv-green text-white rounded-xl hover:bg-sv-green-dark transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Generate All Analyses
                </button>
            </div>
            <div class="mb-4 text-center">
                <span id="analysisStatus" class="text-lg font-medium"></span>
            </div>

            <!-- Tab Navigation -->
            <div class="mb-8">
                <div class="flex space-x-1 bg-white/5 p-1 rounded-lg">
                    <button id="wave1Tab"
                            class="tab-button flex-1 px-6 py-3 text-sm font-medium rounded-md transition-all duration-200 active"
                            onclick="switchTab('wave1')">
                        <span class="flex items-center justify-center">
                            <span class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
                            Wave 1
                            <span id="wave1Count" class="ml-2 px-2 py-1 bg-blue-600/20 text-blue-300 rounded-full text-xs"></span>
                        </span>
                    </button>
                    <button id="wave2Tab"
                            class="tab-button flex-1 px-6 py-3 text-sm font-medium rounded-md transition-all duration-200"
                            onclick="switchTab('wave2')">
                        <span class="flex items-center justify-center">
                            <span class="w-2 h-2 bg-purple-400 rounded-full mr-2"></span>
                            Wave 2
                            <span id="wave2Count" class="ml-2 px-2 py-1 bg-purple-600/20 text-purple-300 rounded-full text-xs"></span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="relative mb-6">
                <input type="text"
                       id="searchInput"
                       class="w-full px-4 py-2 bg-white/10 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-sv-green"
                       placeholder="Search within current wave..."
                       onkeyup="filterSubmissions()">
                <div class="absolute right-3 top-2.5 text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>

            <!-- Submission date mapping from SVApplications.csv -->
            {% set date_mapping = {
                'Test': {'date': '2025-04-08 18:30:34', 'display': 'April 8, 2025 18:30'},
                'DoktorConnect': {'date': '2025-04-23 08:45:05', 'display': 'April 23, 2025 08:45'},
                'Hero': {'date': '2025-04-25 12:26:15', 'display': 'April 25, 2025 12:26'},
                'Defiant Health': {'date': '2025-04-25 22:46:38', 'display': 'April 25, 2025 22:46'},
                'JOGO Health': {'date': '2025-04-29 16:42:53', 'display': 'April 29, 2025 16:42'},
                'Mandala for Us Inc.': {'date': '2025-04-29 22:47:47', 'display': 'April 29, 2025 22:47'},
                'Multiply': {'date': '2025-04-30 21:27:43', 'display': 'April 30, 2025 21:27'},
                'Borderless AI': {'date': '2025-05-01 01:37:06', 'display': 'May 1, 2025 01:37'},
                'Virtual Sapiens': {'date': '2025-05-01 15:48:53', 'display': 'May 1, 2025 15:48'},
                'Toothsome': {'date': '2025-05-02 04:19:13', 'display': 'May 2, 2025 04:19'},
                'Sunny Health AI': {'date': '2025-05-06 02:20:44', 'display': 'May 6, 2025 02:20'},
                'RituWell': {'date': '2025-05-06 22:35:56', 'display': 'May 6, 2025 22:35'},
                'Outro Health': {'date': '2025-05-08 14:10:42', 'display': 'May 8, 2025 14:10'},
                'JOYA Health': {'date': '2025-05-08 17:42:40', 'display': 'May 8, 2025 17:42'},
                'Kept Inc': {'date': '2025-05-09 00:40:07', 'display': 'May 9, 2025 00:40'},
                'Clasp': {'date': '2025-05-09 07:49:03', 'display': 'May 9, 2025 07:49'},
                'Paramean Solutions': {'date': '2025-05-09 18:49:29', 'display': 'May 9, 2025 18:49'},
                'Volta Health': {'date': '2025-05-09 20:28:20', 'display': 'May 9, 2025 20:28'},
                'Guaranteed Health, Inc.': {'date': '2025-05-09 20:58:36', 'display': 'May 9, 2025 20:58'},
                'Ezra': {'date': '2025-05-10 19:22:46', 'display': 'May 10, 2025 19:22'},
                'Lockwell Inc': {'date': '2025-05-14 00:34:15', 'display': 'May 14, 2025 00:34'},
                'Aidora': {'date': '2025-05-15 00:08:11', 'display': 'May 15, 2025 00:08'},
                'Beacon': {'date': '2025-05-16 17:14:43', 'display': 'May 16, 2025 17:14'},
                'Blank Slate Technologies': {'date': '2025-05-23 14:08:10', 'display': 'May 23, 2025 14:08'},
                'Wave': {'date': '2025-05-30 22:28:27', 'display': 'May 30, 2025 22:28'},
                'LOGISTIFY AI': {'date': '2025-06-02 20:14:01', 'display': 'June 2, 2025 20:14'},
                'SmartHeritance': {'date': '2025-06-02 20:34:51', 'display': 'June 2, 2025 20:34'},
                'chainstaff': {'date': '2025-06-03 08:44:10', 'display': 'June 3, 2025 08:44'},
                'CryptoMate': {'date': '2025-06-03 10:51:38', 'display': 'June 3, 2025 10:51'},
                'Graphio.ai': {'date': '2025-06-03 16:11:54', 'display': 'June 3, 2025 16:11'},
                'Wiggl Health': {'date': '2025-06-03 16:42:11', 'display': 'June 3, 2025 16:42'},
                'RainyDayPal': {'date': '2025-06-03 19:47:09', 'display': 'June 3, 2025 19:47'},
                'NuCo Credentialing': {'date': '2025-06-03 23:11:42', 'display': 'June 3, 2025 23:11'},
                'Workrz': {'date': '2025-06-04 18:33:48', 'display': 'June 4, 2025 18:33'},
                'GTM Flow': {'date': '2025-04-17 18:45:47', 'display': 'April 17, 2025 18:45'},
                'GigEasy': {'date': '2025-07-24 10:00:00', 'display': 'July 24, 2025 10:00'},
                'GigHQ.ai': {'date': '2025-07-24 10:15:00', 'display': 'July 24, 2025 10:15'},
                'iCommute': {'date': '2025-07-24 10:30:00', 'display': 'July 24, 2025 10:30'},
                'The PEO App, Inc.': {'date': '2025-07-24 10:45:00', 'display': 'July 24, 2025 10:45'},
                'Cherrygiving': {'date': '2025-07-24 11:00:00', 'display': 'July 24, 2025 11:00'}
            } %}

            <!-- Process submissions and add dates -->
            {% set all_submissions = [] %}

            {% for submission in submissions %}
                {% set submission_date = namespace(value='') %}
                {% if submission.company_name and submission.company_name.strip() in date_mapping %}
                    {% set submission_date.value = date_mapping[submission.company_name.strip()]['date'] %}
                    {% set _ = submission.update({'_submission_date': submission_date.value}) %}
                {% else %}
                    {% set _ = submission.update({'_submission_date': '2025-06-01 00:00:00'}) %}
                {% endif %}
                {% set _ = all_submissions.append(submission) %}
            {% endfor %}

            <!-- Separate submissions into waves -->
            {% set wave1_submissions = [] %}
            {% set wave2_submissions = [] %}
            {% set wave_cutoff = '2025-06-05 00:00:00' %}

            {% for submission in all_submissions %}
                {% if submission._submission_date < wave_cutoff %}
                    {% set _ = wave1_submissions.append(submission) %}
                {% else %}
                    {% set _ = wave2_submissions.append(submission) %}
                {% endif %}
            {% endfor %}

            <!-- Wave 1 Tab Content -->
            <div id="wave1Content" class="tab-content">
                <div class="mb-6 text-center">
                    <h2 class="text-xl font-semibold text-white mb-2">Wave 1 Submissions</h2>
                    <p class="text-gray-400 text-sm">Through June 4th, 2025</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for submission in wave1_submissions|sort(attribute='_submission_date') %}
                    {% set submission_date = 'N/A' %}
                    {% if submission.company_name and submission.company_name.strip() in date_mapping %}
                        {% set submission_date = date_mapping[submission.company_name.strip()]['display'] %}
                    {% endif %}
                    
                    <div class="submission-card bg-white/5 backdrop-blur-md rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 overflow-hidden border border-gray-700">
                        <div class="p-6">
                            <div class="mb-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-xl font-semibold text-white">
                                        {{ submission.company_name }}
                                    </h3>
                                    <span class="text-sm text-gray-400">
                                        Submitted: {{ submission_date }}
                                    </span>
                                </div>
                                <p class="text-gray-300 mb-4 line-clamp-3">
                                    {{ submission.description }}
                                </p>
                            </div>
                            
                            <div class="space-y-2 mb-4">
                                <div class="text-sm">
                                    <span class="text-gray-400">Website:</span><br>
                                    <a href="{{ submission.website }}" 
                                       class="text-sv-green hover:text-sv-green-dark" 
                                       target="_blank">
                                        {{ submission.website|truncate(30) }}
                                    </a>
                                </div>
                                <div class="text-sm">
                                    <span class="text-gray-400">Founded:</span><br>
                                    <span class="text-gray-300">{{ submission.year_founded|default('N/A') }}</span>
                                </div>
                                <div class="text-sm">
                                    <span class="text-gray-400">Founder:</span><br>
                                    <span class="text-gray-300">{{ submission.founder_profile.name if submission.founder_profile and submission.founder_profile.name else 'N/A' }}</span>
                                </div>
                                
                                {% if submission.final_recommendation and submission.final_recommendation.status %}
                                <div class="text-sm mt-3">
                                    <span class="text-gray-400">Status:</span><br>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium
                                        {% if submission.final_recommendation.status == 'Advance' %}
                                            bg-green-100 text-green-800
                                        {% elif submission.final_recommendation.status == 'Hold' %}
                                            bg-yellow-100 text-yellow-800
                                        {% else %}
                                            bg-gray-100 text-gray-800
                                        {% endif %}">
                                        {{ submission.final_recommendation.status }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>

                            <div class="flex justify-end">
                                {% if submission.company_name %}
                                    {% set url_name = submission.company_name.lower().replace(' ', '').replace('-', '').replace('_', '').replace('.', '').replace(',', '') %}
                                    <a href="{{ url_for('submission_detail', company_name=url_name) }}"
                                       class="inline-flex items-center px-4 py-2 text-sm font-medium bg-sv-green text-white rounded-lg hover:bg-sv-green-dark">
                                        View Analysis
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Wave 2 Tab Content -->
            <div id="wave2Content" class="tab-content" style="display: none;">
                <div class="mb-6 text-center">
                    <h2 class="text-xl font-semibold text-white mb-2">Wave 2 Submissions</h2>
                    <p class="text-gray-400 text-sm">June 5th onwards, 2025</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for submission in wave2_submissions|sort(attribute='_submission_date') %}
                    {% set submission_date = 'N/A' %}
                    {% if submission.company_name and submission.company_name.strip() in date_mapping %}
                        {% set submission_date = date_mapping[submission.company_name.strip()]['display'] %}
                    {% endif %}

                    <div class="submission-card bg-white/5 backdrop-blur-md rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 overflow-hidden border border-gray-700">
                        <div class="p-6">
                            <div class="mb-4">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="text-xl font-semibold text-white">
                                        {{ submission.company_name }}
                                    </h3>
                                    <span class="text-sm text-gray-400">
                                        Submitted: {{ submission_date }}
                                    </span>
                                </div>
                                <p class="text-gray-300 mb-4 line-clamp-3">
                                    {{ submission.description }}
                                </p>
                            </div>

                            <div class="space-y-2 mb-4">
                                <div class="text-sm">
                                    <span class="text-gray-400">Website:</span><br>
                                    <a href="{{ submission.website }}"
                                       class="text-sv-green hover:text-sv-green-dark"
                                       target="_blank">
                                        {{ submission.website|truncate(30) }}
                                    </a>
                                </div>
                                <div class="text-sm">
                                    <span class="text-gray-400">Founded:</span><br>
                                    <span class="text-gray-300">{{ submission.year_founded|default('N/A') }}</span>
                                </div>
                                <div class="text-sm">
                                    <span class="text-gray-400">Founder:</span><br>
                                    <span class="text-gray-300">{{ submission.founder_profile.name if submission.founder_profile and submission.founder_profile.name else 'N/A' }}</span>
                                </div>

                                {% if submission.final_recommendation and submission.final_recommendation.status %}
                                <div class="text-sm mt-3">
                                    <span class="text-gray-400">Status:</span><br>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium
                                        {% if submission.final_recommendation.status == 'Advance' %}
                                            bg-green-100 text-green-800
                                        {% elif submission.final_recommendation.status == 'Hold' %}
                                            bg-yellow-100 text-yellow-800
                                        {% else %}
                                            bg-gray-100 text-gray-800
                                        {% endif %}">
                                        {{ submission.final_recommendation.status }}
                                    </span>
                                </div>
                                {% endif %}
                            </div>

                            <div class="flex justify-end">
                                {% if submission.company_name %}
                                    {% set url_name = submission.company_name.lower().replace(' ', '').replace('-', '').replace('_', '').replace('.', '').replace(',', '') %}
                                    <a href="{{ url_for('submission_detail', company_name=url_name) }}"
                                       class="inline-flex items-center px-4 py-2 text-sm font-medium bg-sv-green text-white rounded-lg hover:bg-sv-green-dark">
                                        View Analysis
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </main>
    </div>

    <script>
        let currentWave = 'wave1';
        let wave1Count = 0;
        let wave2Count = 0;

        // Initialize tab functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Count companies in each wave
            wave1Count = document.querySelectorAll('#wave1Content .submission-card').length;
            wave2Count = document.querySelectorAll('#wave2Content .submission-card').length;

            // Update tab counters
            document.getElementById('wave1Count').textContent = wave1Count;
            document.getElementById('wave2Count').textContent = wave2Count;

            // Show Wave 1 by default
            switchTab('wave1');
        });

        function switchTab(waveId) {
            currentWave = waveId;

            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(waveId + 'Tab').classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.getElementById(waveId + 'Content').style.display = 'block';

            // Clear search and reset filters
            document.getElementById('searchInput').value = '';
            filterSubmissions();

            // Update search placeholder
            const searchInput = document.getElementById('searchInput');
            const waveName = waveId === 'wave1' ? 'Wave 1' : 'Wave 2';
            searchInput.placeholder = `Search within ${waveName}...`;
        }

        function filterSubmissions() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.toLowerCase();
            const searchResults = document.getElementById('search-results');
            const totalCount = document.getElementById('total-count');
            const visibleCountSpan = document.getElementById('visible-count');

            // Get cards from current active tab only
            const activeContent = document.getElementById(currentWave + 'Content');
            const submissionCards = activeContent.querySelectorAll('.submission-card');
            let visibleCount = 0;

            // Filter cards in current wave
            for (let card of submissionCards) {
                const companyName = card.querySelector('h3').textContent.toLowerCase();
                const description = card.querySelector('p').textContent.toLowerCase();
                const founder = card.querySelector('.text-gray-300').textContent.toLowerCase();
                const website = card.querySelector('a[href^="http"]').textContent.toLowerCase();

                if (searchTerm.trim() === '' ||
                    companyName.includes(searchTerm) ||
                    description.includes(searchTerm) ||
                    founder.includes(searchTerm) ||
                    website.includes(searchTerm)) {
                    card.style.display = '';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            }

            // Update search results display
            if (searchTerm.trim() === '') {
                searchResults.style.display = 'none';
                totalCount.style.display = '';
            } else {
                const totalInWave = currentWave === 'wave1' ? wave1Count : wave2Count;
                visibleCountSpan.textContent = visibleCount;
                document.getElementById('visible-count').nextSibling.textContent = ` of ${totalInWave} submissions in ${currentWave === 'wave1' ? 'Wave 1' : 'Wave 2'}`;
                searchResults.style.display = '';
                totalCount.style.display = 'none';
            }
        }
    </script>

    <!-- Add this JavaScript at the bottom of the file, before closing </body> -->
    <script>
    document.getElementById('generateAnalysis').addEventListener('click', function() {
        const button = this;
        const status = document.getElementById('analysisStatus');
        
        button.disabled = true;
        button.textContent = 'Generating...';
        status.textContent = 'Processing companies...';
        
        fetch('/generate_analysis')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    status.textContent = data.message;
                    status.className = 'text-success';
                    // Refresh the page after 2 seconds to show new analyses
                    setTimeout(() => location.reload(), 2000);
                } else {
                    status.textContent = 'Error: ' + data.message;
                    status.className = 'text-danger';
                }
            })
            .catch(error => {
                status.textContent = 'Error: ' + error.message;
                status.className = 'text-danger';
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'Generate All Analyses';
            });
    });
    </script>
</body>
</html>
